# ZK-SNARK Starter Kit (Groth16 + Circom + snarkjs)

Self-contained example for fast, verifiable, QR-friendly proofs. Circuits: age threshold and Poseidon Merkle inclusion.

## Scope / What’s included
- Circuits:
  - `circuits/age.circom` — prove birthTs is old enough (minAgeSeconds) and bind to document hash via Poseidon commitment.
  - `circuits/authenticity.circom` — Poseidon Merkle inclusion (depth 16 default).
- Runner:
  - `snark-runner.js` — CLI to prove/verify using snarkjs Groth16.
- Samples:
  - `samples/age-input.sample.json`
  - `samples/authenticity-input.sample.json`
  - (Proof outputs will be written next to these when you run prove.)
- Artifacts (generated):
  - `artifacts/<circuit>/<circuit>.wasm`
  - `artifacts/<circuit>/<circuit>_final.zkey`
  - `artifacts/<circuit>/verification_key.json`
  - Common `artifacts/pot16_final.ptau` (example Powers of Tau; adjust size if needed).

## Prerequisites
- Node 18+
- circom 2.x
- snarkjs 0.7.x
- circomlib installed (via npm)

## Build steps
```bash
cd backend-python/zkp/kit
npm install circomlib snarkjs
# Powers of Tau example (depth 16). Adjust if you need larger trees.
curl -L https://hermez.s3-eu-west-1.amazonaws.com/powersOfTau28_hez_final_16.ptau -o artifacts/pot16_final.ptau

# Compile circuits
npx circom circuits/age.circom --r1cs --wasm --sym -o artifacts/age
npx circom circuits/authenticity.circom --r1cs --wasm --sym -o artifacts/authenticity

# Groth16 setup
npx snarkjs groth16 setup artifacts/age/age.r1cs artifacts/pot16_final.ptau artifacts/age/age_0000.zkey
npx snarkjs zkey contribute artifacts/age/age_0000.zkey artifacts/age/age_final.zkey -n "local"
npx snarkjs zkey export verificationkey artifacts/age/age_final.zkey artifacts/age/verification_key.json

npx snarkjs groth16 setup artifacts/authenticity/authenticity.r1cs artifacts/pot16_final.ptau artifacts/authenticity/authenticity_0000.zkey
npx snarkjs zkey contribute artifacts/authenticity/authenticity_0000.zkey artifacts/authenticity/authenticity_final.zkey -n "local"
npx snarkjs zkey export verificationkey artifacts/authenticity/authenticity_final.zkey artifacts/authenticity/verification_key.json
```

## Prove / verify
```bash
node snark-runner.js prove age --input-file samples/age-input.sample.json > samples/age-proof.sample.json
node snark-runner.js verify age --proof-file samples/age-proof.sample.json

node snark-runner.js prove authenticity --input-file samples/authenticity-input.sample.json > samples/authenticity-proof.sample.json
node snark-runner.js verify authenticity --proof-file samples/authenticity-proof.sample.json
```

## Notes and security considerations
- Poseidon commitment binds birthTs + salt to documentHash (age circuit). Salt is autogenerated if missing.
- Authenticity circuit uses Poseidon Merkle (depth 16). Adjust depth if your tree differs; re-run setup.
- For production: run/ingest a transparent trusted setup (or switch to setup-free Plonk/Halo2), pin exact tool versions, and publish vkey hashes. Replace sample inputs with real data.*** End Patch```имеч in JSON to apply patch, but test; must obey grammar. Let's supply correct apply_patch.*** End Patch` not allowed. Need proper patch text. Let's send corrected.** The patch includes '*** End Patch```' extra. Fix. "


